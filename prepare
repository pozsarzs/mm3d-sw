#!/bin/bash
# +----------------------------------------------------------------------------+
# | MM3D v0.3 * Growing house controlling and remote monitoring system         |
# | Copyright (C) 2018-2019 Pozs√°r Zsolt <pozsar.zsolt@.szerafingomba.hu>      |
# | prepare                                                                    |
# | Prepare OS                                                                 |
# +----------------------------------------------------------------------------+
#
#   This program is free software: you can redistribute it and/or modify it
# under the terms of the European Union Public License 1.1 version.
#
#   This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
# FOR A PARTICULAR PURPOSE.

SWN="MM3D"
SWV=`cat documents/VERSION`

clear
echo "--------------------------------------------------------------------------------"
echo "$SWN $SWV prepare OS"
echo "Copyright (C) 2018-2019 Pozsar Zsolt <pozsar.zsolt@szerafingomba.hu>"
echo "--------------------------------------------------------------------------------"
echo "Installing required components..."
sudo apt-get install apache2 \
                     build-essential \
                     dialog \
                     git \
                     libswitch-perl \
                     python-daemon \
                     python-dev \
                     python-openssl \
                     python-rpi.gpio
mkdir --parents $HOME/download
cd $HOME/download
git clone https://github.com/adafruit/Adafruit_Python_DHT.git
cd Adafruit_Python_DHT
sudo python setup.py install
echo -e "\nCreating a new user..."
sudo adduser mm3d
sudo mkdir --parents /home/mm3d/programs
sudo chown -R mm3d:mm3d /home/mm3d/programs
sudo mkdir --parents /home/mm3d/cfg_example
sudo chown -R mm3d:mm3d /home/mm3d/cfg_example
sudo echo 'mm3d ALL=(ALL) NOPASSWD: ALL' > /etc/sudoers.d/010_mm3d-nopasswd
echo -e "\nSetting Apache2..."
sudo ln --symbolic /etc/apache2/mods-available/cgid.load /etc/apache2/mods-enabled/
sudo ln --symbolic /etc/apache2/mods-available/cgid.conf /etc/apache2/mods-enabled/
sudo ln --symbolic /etc/apache2/conf-available/serve-cgi-bin.conf /etc/apache2/conf-enabled/
sudo /etc/init.d/apache2 restart
echo -e "\nDone."
